<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Despensa</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50">

<style>
  @font-face { font-family: 'Inter'; src: url('fonts/Inter-Regular.woff2') format('woff2'); font-weight: 400;}
  @font-face { font-family: 'Inter'; src: url('fonts/Inter-Medium.woff2') format('woff2'); font-weight: 500;}
  @font-face { font-family: 'Inter'; src: url('fonts/Inter-SemiBold.woff2') format('woff2'); font-weight: 600;}

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background:#f2f2f7;
    -webkit-font-smoothing: antialiased;
  }

  /* ===== HEADER ===== */
  header{
    background:#fff;
    padding:12px;
    border-bottom:1px solid #ddd;
  }
  .top{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }
  .menu{
    font-size:28px;
    cursor:pointer;
    position: relative;
    top: -5px;
  }
  .addMain{
    margin-left:auto;
    font-size:16px;
    cursor:pointer;
    font-weight:600;
  }
  h1{
    margin:0 0 10px 0;
    font-size:20px;
  }
  .search input{
    width:100%;
    padding:10px;
    font-size:16px;
    border:none;
    border-radius:10px;
    background:#e5e5ea;
  }

  /* Botones de exportar/importar peque√±os */
  .smallBtn{
    padding:6px 10px;
    font-size:14px;
    border-radius:8px;
    background:#e0e0e0;
    color:#000;
    font-weight:500;
    display:inline-block;
  }

  /* Bot√≥n a√±adir art√≠culo destacado */
  .highlightBtn{
    padding:10px 16px;
    font-size:16px;
    border-radius:12px;
    background:#43a047;
    color:#fff;
    font-weight:600;
  }

  /* ===== DRAWER ===== */
  #drawer {
    position: fixed;
    top: 0; bottom: 0; left: 0;
    width: 260px;
    background: #fff;
    transform: translateX(-100%);
    transition: .3s;
    padding: 16px;
    z-index: 20;
  }
  #drawer.open { transform: translateX(0);}
  #drawer button {
    width: 100%;
    padding: 13px;
    margin-bottom: 10px;
    border: 1px solid #000;
    border-radius: 12px;
    background: #fff;
    font-weight: 600;
    font-size: 14px;
    text-align: left;
  }
  #drawer button.active { background: #000; color: #fff;}
  #drawer button:hover { background: #333; color: #fff;}

  /* ===== LISTA ===== */
  main{ padding:12px; padding-bottom:12px;}
  .item{
    background:#fff;
    border-radius:12px;
    padding:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:8px;
  }
  .item small{
    display:block;
    color:#666;
    font-size:12px;
  }
  .item > div{ display:flex;}
  .item button{
    width:36px;
    height:36px;
    border:none;
    border-radius:10px;
    font-size:18px;
    font-weight:600;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .add{ background:#000; color:#fff;}
  .del{ background:#ff3b30; color:#fff;}

  /* ===== MODALES ===== */
  .modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.4);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:50;
  }
  .modal .box{
    background:#fff;
    border-radius:16px;
    padding:20px;
    width:90%;
    max-width:400px;
    max-height:80vh;
    overflow-y:auto;
  }
  .modal input, .modal select, .modal textarea{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    font-size:16px;
    border-radius:10px;
    border:1px solid #ccc;
  }
  .modal h3{ font-size:16px; margin:0 0 12px; text-align:center;}
  .modal p{ font-size:16px; margin:14px 0 6px; font-weight:600;}
  .btns.qty{ display:grid; grid-template-columns:repeat(5,1fr); gap:8px;}
  .btns.unit{ display:flex; gap:8px;}
  .btns button{
    font-size:16px;
    padding:10px 0;
    border:1px solid #000;
    border-radius:12px;
    background:#fff;
    font-weight:600;
  }
  .btns button.active{ background:#000; color:#fff;}
  .modal .box > div:last-child{ display:flex; gap:8px; margin-top:16px;}
  .modal #add,.modal #save,.modal #send{ background:#43a047; color:#fff;}
  .modal #cancel{ background:#ff3b30; color:#fff;}
  .modal button{ flex:1; padding:12px; border:none; border-radius:12px; font-weight:600;}

  /* ===== BOT√ìN VER TICKET ===== */
  #viewTicketBtn{
    position:fixed;
    bottom:20px;
    right:20px;
    padding:12px 16px;
    border-radius:12px;
    background:#000;
    color:#fff;
    font-weight:600;
    z-index:50;
    border:none;
    cursor:pointer;
  }

  /* ===== NORMALIZAR BOTONES (Safari iOS) ===== */
  button{ appearance:none; -webkit-appearance:none;}

  /* ===== TICKET MEJORADO (SIN ROMPER APP) ===== */

/* Lista con scroll */
#ticketList{
  list-style:none;
  padding:0;
  margin:8px 0;
  max-height:40vh;
  overflow-y:auto;
}

/* Fila tipo tabla */
#ticketList li{
  display:grid;
  grid-template-columns:1fr auto 28px;
  align-items:center;
  gap:8px;
  padding:8px 6px;
  border-bottom:1px solid #eee;
  font-size:14px;
}

/* Texto art√≠culo */
#ticketList li span{
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}

/* Unidades */
#ticketList li strong{
  font-weight:600;
  font-size:14px;
}

/* Bot√≥n eliminar peque√±o y alineado */
#ticketList .del{
  width:24px;
  height:24px;
  font-size:14px;
  padding:0;
  border-radius:6px;
}

/* Botones del ticket en horizontal */
.ticket-actions{
  display:grid !important;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
}

.ticket-actions button{
  padding:10px;
  font-size:14px;
  font-weight:600;
}

</style>
</head>
<body>

<div id="drawer"></div>

<header>
  <div class="top">
    <div class="menu" onclick="toggleDrawer()">‚â°</div>
    <h1>Despensa</h1>
    <div class="addMain" id="editBtn" onclick="toggleEditMode()">‚úèÔ∏è Editar</div>

    <!-- Botones de edici√≥n -->
    <div id="editButtons" style="display:none; gap:8px; align-items:center; margin-left:auto;">
      <button onclick="exportData()" class="smallBtn">üíæ Exportar</button>
      <button onclick="document.getElementById('importFile').click()" class="smallBtn">üìÇ Importar</button>
      <input type="file" id="importFile" style="display:none" onchange="importData(event)">
      <button id="addItemBtn" class="highlightBtn" onclick="showAddItem()">‚ûï A√±adir art√≠culo</button>
    </div>
  </div>

  <div class="search">
    <input id="search" placeholder="Buscar..." oninput="render()">
  </div>
</header>

<main id="list"></main>

<!-- BOT√ìN VER TICKET -->
<button id="viewTicketBtn" onclick="openTicketModal()">üßæ Ver Ticket [ 00 ]</button>

<!-- MODAL TICKET -->
<div id="ticketModal" class="modal">
  <div class="box">
    <strong>üßæ Ticket</strong>
    <div id="ticketSummary" style="margin-bottom:12px; font-weight:600;"></div>
    <div style="
  display:grid;
  grid-template-columns:1fr auto 28px;
  font-size:13px;
  font-weight:600;
  color:#666;
  padding:6px;
  border-bottom:1px solid #ddd;
">
  <span>Art√≠culo</span>
  <span>Unid.</span>
  <span></span>
</div>
    <ul id="ticketList"></ul>
    <div class="ticket-actions" style="margin-top:12px; display:flex; gap:8px;">
      <button onclick="printTicket()">üñ®Ô∏è Imprimir</button>
      <button onclick="sendWhatsApp()">üì≤ WhatsApp</button>
      <button onclick="resetTicket()">üÜï Nuevo Ticket</button>
      <button onclick="closeTicketModal()">‚ùå Cerrar</button>
    </div>
  </div>
</div>

<!-- MODAL CONFIRMACI√ìN -->
<div id="confirmModal" class="modal">
  <div class="box">
    <p id="confirmText"></p>
    <div>
      <button id="add" onclick="confirmDelete()">Aceptar</button>
      <button id="cancel" onclick="closeConfirm()">Cancelar</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script>
  // Botones edici√≥n
  const editButtons = document.getElementById("editButtons");
  let editMode = false;
  function toggleEditMode(){
    editMode = !editMode;
    editButtons.style.display = editMode ? "flex" : "none";
    render();
    document.getElementById("editBtn").textContent = editMode ? "‚Ü©Ô∏è Volver" : "‚úèÔ∏è Editar";
  }

  // Modal ticket
  function openTicketModal(){
    document.getElementById("ticketModal").style.display = "flex";
    renderTicket();
  }
  function closeTicketModal(){
    document.getElementById("ticketModal").style.display = "none";
  }
</script>
</body>
</html>
